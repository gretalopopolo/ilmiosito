<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monet Style Portrait - Interactive</title>

<script src="https://cdn.jsdelivr.net/npm/p5@1.5.0/lib/p5.min.js"></script>

<style>
    body {
        margin: 0;
        background-color: black;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
</style>
</head>

<body>
<script>
let faccione;
let imgW, imgH;
let imgOX, imgOY;

function preload() {
    faccione = loadImage("selfie.png"); // sostituisci con la tua immagine
}

function setup() {
    createCanvas(800, 700);
    colorMode(HSB, 360, 100, 100);
    noStroke();
    frameRate(30);

    // scala l'immagine per coprire quasi tutto il canvas
    let scale = max(width / faccione.width, height / faccione.height) * 1.35;
    imgW = faccione.width * scale;
    imgH = faccione.height * scale;

    imgOX = (width - imgW) / 2;
    imgOY = (height - imgH) / 2 + 80;

    faccione.resize(imgW, imgH);
}

function draw() {
    background(20, 20, 10); 

    let numH = 80; 
    let numV = 60; 
    let d = 10;

    let ox = (width - (numH - 1) * d) / 2;
    let oy = (height - (numV - 1) * d) / 2;

    // controlla se il mouse Ã¨ sopra l'immagine
    let mouseOverImage = mouseX >= imgOX && mouseX <= imgOX + imgW &&
                         mouseY >= imgOY && mouseY <= imgOY + imgH;

    for (let j = 0; j < numV; j++) {
        for (let i = 0; i < numH; i++) {

            let px = ox + i * d;
            let py = oy + j * d;

            let wave = sin(frameCount * 0.03 + i * 0.3 + j * 0.3) * random(1,3);
            let wx = px + random(-1.5,1.5);
            let wy = py + wave + random(-1.5,1.5);

            if (mouseOverImage) {
                // calcola distanza dal cursore
                let dx = wx - mouseX;
                let dy = wy - mouseY;
                let distMouse = sqrt(dx * dx + dy * dy);
                let radius = 600; 
                if (distMouse < radius) {
                    let force = map(distMouse, 0, radius, 25, 0); 
                    wx += (dx / distMouse) * force + random(-10,10);
                    wy += (dy / distMouse) * force + random(-10,10);
                }
            }

            let ix = wx - imgOX;
            let iy = wy - imgOY;

            if (ix >= 0 && ix < imgW && iy >= 0 && iy < imgH) {
                let c = faccione.get(ix, iy);

                let h = hue(color(c)) + random(-5,5);
                let s = saturation(color(c)) * random(0.9,1.1);
                let b = brightness(color(c)) * random(0.9,1.05);

                fill(h, s, b, 90);

                let lum = (red(c) + green(c) + blue(c)) / 3;
                let r = map(lum, 0, 255, 6, 14);

                ellipse(wx, wy, r, r * random(0.9,1.1));

                if (random() < 0.2) {
                    ellipse(wx + random(-2,2), wy + random(-2,2), r*0.6, r*0.6);
                }
            }
        }
    }
}
</script>
</body>
</html>
